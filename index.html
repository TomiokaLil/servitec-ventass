<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro de Ventas - SERVITEC</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #111; 
      color: #fff;
    }
    h1, h2 {
      text-align: center;
      color: #ff0000;
    }
    form {
      background: #222;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0px 2px 6px rgba(255,0,0,0.4);
      max-width: 500px;
      margin: auto;
      color: #fff;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ff0000;
      border-radius: 5px;
      background: #111;
      color: #fff;
    }
    button {
      margin-top: 15px;
      padding: 10px;
      width: 100%;
      background: #ff0000;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
    }
    button:hover {
      background: #cc0000;
    }
    table {
      margin-top: 20px;
      width: 100%;
      border-collapse: collapse;
      background: #222;
    }
    th, td {
      padding: 10px;
      border: 1px solid #444;
      text-align: center;
    }
    th {
      background: #ff0000;
      color: white;
    }
    td {
      color: #fff;
    }
    .container {
      max-width: 900px;
      margin: auto;
    }
    .acciones button {
      margin: 2px;
      padding: 5px 10px;
      font-size: 14px;
      border-radius: 5px;
      border: none;
    }
    .acciones button:first-child {
      background: #ffaa00;
      color: #000;
    }
    .acciones button:last-child {
      background: #ff0000;
      color: #fff;
    }
    #totalVentas {
      margin-top: 15px;
      font-weight: bold;
      font-size: 18px;
      text-align: right;
      color: #ff0000;
    }
    .logo {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .logo img {
      max-width: 150px;
    }
    #otroDesc {
      display: none;
    }
    .extra-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
    }
    .extra-buttons button {
      background: #444;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }
    .extra-buttons button:hover {
      background: #666;
    }
  </style>
</head>
<body>
  <div class="logo">
    <img src="logo.png" alt="Logo SERVITEC">
  </div>

  <h1>Registro de Ventas - SERVITEC</h1>
  <div class="container">
    <!-- FORMULARIO VENTAS -->
    <form id="ventaForm">
      <input type="hidden" id="editIndex" value="">
      
      <label for="usuario">Usuario:</label>
      <input type="text" id="usuario" required>

      <label for="servicio">Servicio:</label>
      <select id="servicio" required>
        <option value="Cambio de pantalla">Cambio de pantalla</option>
        <option value="Cambio de bater√≠a">Cambio de bater√≠a</option>
        <option value="Mantenimiento general">Mantenimiento general</option>
        <option value="Reparaci√≥n de puerto de carga">Reparaci√≥n de puerto de carga</option>
        <option value="Otro">Otro</option>
      </select>

      <div id="otroDesc">
        <label for="descripcion">Descripci√≥n:</label>
        <textarea id="descripcion" rows="3"></textarea>
      </div>

      <label for="precio">Precio (MXN):</label>
      <input type="number" id="precio" required>

      <label for="fecha">Fecha:</label>
      <input type="date" id="fecha" required>

      <button type="submit">Guardar Venta</button>
    </form>

    <!-- TABLA VENTAS -->
    <h2>Ventas Registradas</h2>
    <table id="tablaVentas">
      <thead>
        <tr>
          <th>Usuario</th>
          <th>Servicio</th>
          <th>Precio</th>
          <th>Fecha</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="totalVentas">Total de Ventas: $0</div>

    <!-- APARTADO PENDIENTES -->
    <h2>
      <button onclick="togglePendientes()" 
        style="background:none; border:none; color:#ff0000; font-size:18px; cursor:pointer;">
        üì¶ Pendientes por Entregar <span id="flechaPend">‚¨áÔ∏è</span>
      </button>
    </h2>

    <div id="pendientesContainer" style="display:none;">
      <form id="pendienteForm">
        <label for="reparacionPend">Reparaci√≥n:</label>
        <input type="text" id="reparacionPend" required>

        <label for="dispositivoPend">Dispositivo:</label>
        <input type="text" id="dispositivoPend" required>

        <label for="montoPend">Monto (MXN):</label>
        <input type="number" id="montoPend" required>

        <button type="submit">Agregar Pendiente</button>
      </form>

      <table id="tablaPendientes">
        <thead>
          <tr>
            <th>Reparaci√≥n</th>
            <th>Dispositivo</th>
            <th>Monto</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- APARTADO HISTORIAL -->
    <h2>
      <button id="toggleHistorialBtn" onclick="toggleHistorial()" 
        style="background:none; border:none; color:#ff0000; font-size:18px; cursor:pointer;">
        üìú Historial Completo <span id="flecha">‚¨áÔ∏è</span>
      </button>
    </h2>

    <div id="historialContainer" style="display:none;">
      <table id="tablaHistorial">
        <thead>
          <tr>
            <th>Usuario</th>
            <th>Servicio</th>
            <th>Precio</th>
            <th>Fecha</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="extra-buttons">
        <button onclick="limpiarHistorial()">üóëÔ∏è Limpiar Historial</button>
        <button onclick="borrarVentas()">‚ùå Borrar Ventas</button>
      </div>
    </div>
  </div>

  <script>
    const usuarioInput = document.getElementById("usuario");
    const fechaInput = document.getElementById("fecha");
    const tablaBody = document.querySelector("#tablaVentas tbody");
    const historialBody = document.querySelector("#tablaHistorial tbody");
    const pendientesBody = document.querySelector("#tablaPendientes tbody");
    const totalVentasEl = document.getElementById("totalVentas");

    // === FUNCIONES DE PENDIENTES ===
    function togglePendientes() {
      const cont = document.getElementById("pendientesContainer");
      const flecha = document.getElementById("flechaPend");
      if (cont.style.display === "none") {
        cont.style.display = "block";
        flecha.textContent = "‚¨ÜÔ∏è";
      } else {
        cont.style.display = "none";
        flecha.textContent = "‚¨áÔ∏è";
      }
    }

    document.getElementById("pendienteForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const reparacion = document.getElementById("reparacionPend").value;
      const dispositivo = document.getElementById("dispositivoPend").value;
      const monto = document.getElementById("montoPend").value;

      let pendientes = JSON.parse(localStorage.getItem("pendientes")) || [];
      pendientes.push({ reparacion, dispositivo, monto });
      localStorage.setItem("pendientes", JSON.stringify(pendientes));

      e.target.reset();
      cargarPendientes();
    });

    function cargarPendientes() {
      let pendientes = JSON.parse(localStorage.getItem("pendientes")) || [];
      pendientesBody.innerHTML = "";
      pendientes.forEach((p, i) => {
        const fila = `<tr>
          <td>${p.reparacion}</td>
          <td>${p.dispositivo}</td>
          <td>$${p.monto}</td>
          <td><button onclick="marcarEntregado(${i})">‚úÖ Entregado</button></td>
        </tr>`;
        pendientesBody.innerHTML += fila;
      });
    }

    function marcarEntregado(i) {
      let pendientes = JSON.parse(localStorage.getItem("pendientes")) || [];
      const entregado = pendientes.splice(i, 1)[0];
      localStorage.setItem("pendientes", JSON.stringify(pendientes));

      // Se agrega a ventas e historial
      let ventas = JSON.parse(localStorage.getItem("ventas")) || [];
      let historial = JSON.parse(localStorage.getItem("historial")) || [];
      const nuevaVenta = { 
        usuario: usuarioInput.value || "Cliente", 
        servicio: entregado.reparacion + " - " + entregado.dispositivo, 
        descripcion: "", 
        precio: entregado.monto, 
        fecha: fechaInput.value || new Date().toISOString().split("T")[0] 
      };
      ventas.push(nuevaVenta);
      historial.push(nuevaVenta);
      localStorage.setItem("ventas", JSON.stringify(ventas));
      localStorage.setItem("historial", JSON.stringify(historial));

      cargarPendientes();
      cargarVentas();
    }

    // === VENTAS DIRECTAS ===
    document.getElementById("ventaForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const usuario = usuarioInput.value;
      const servicio = document.getElementById("servicio").value;
      const descripcion = document.getElementById("descripcion").value;
      const precio = document.getElementById("precio").value;
      const fecha = fechaInput.value;

      let ventas = JSON.parse(localStorage.getItem("ventas")) || [];
      let historial = JSON.parse(localStorage.getItem("historial")) || [];

      const nuevaVenta = { usuario, servicio, descripcion, precio, fecha };
      ventas.push(nuevaVenta);
      historial.push(nuevaVenta);

      // Guardar usuario y fecha para futuras ventas
      localStorage.setItem("ultimoUsuario", usuario);
      localStorage.setItem("ultimaFecha", fecha);

      localStorage.setItem("ventas", JSON.stringify(ventas));
      localStorage.setItem("historial", JSON.stringify(historial));

      e.target.reset();

      // Restaurar usuario y fecha autom√°ticamente
      usuarioInput.value = localStorage.getItem("ultimoUsuario");
      fechaInput.value = localStorage.getItem("ultimaFecha");

      cargarVentas();
    });

    // === VENTAS + HISTORIAL ===
    function cargarVentas() {
      const ventas = JSON.parse(localStorage.getItem("ventas")) || [];
      const historial = JSON.parse(localStorage.getItem("historial")) || [];
      tablaBody.innerHTML = "";
      historialBody.innerHTML = "";
      let total = 0;

      ventas.forEach((venta, index) => {
        total += parseFloat(venta.precio);
        const fila = `<tr>
          <td>${venta.usuario}</td>
          <td>${venta.servicio}${venta.descripcion ? " - " + venta.descripcion : ""}</td>
          <td>$${venta.precio}</td>
          <td>${venta.fecha}</td>
          <td class="acciones">
            <button onclick="eliminarVenta(${index})">Eliminar</button>
          </td>
        </tr>`;
        tablaBody.innerHTML += fila;
      });

      historial.forEach((venta) => {
        const filaHist = `<tr>
          <td>${venta.usuario}</td>
          <td>${venta.servicio}${venta.descripcion ? " - " + venta.descripcion : ""}</td>
          <td>$${venta.precio}</td>
          <td>${venta.fecha}</td>
        </tr>`;
        historialBody.innerHTML += filaHist;
      });

      totalVentasEl.textContent = "Total de Ventas: $" + total.toFixed(2);
    }

    function eliminarVenta(index) {
      let ventas = JSON.parse(localStorage.getItem("ventas")) || [];
      ventas.splice(index, 1);
      localStorage.setItem("ventas", JSON.stringify(ventas));
      cargarVentas();
    }

    // === HISTORIAL ===
    function toggleHistorial() {
      const cont = document.getElementById("historialContainer");
      const flecha = document.getElementById("flecha");
      if (cont.style.display === "none") {
        cont.style.display = "block";
        flecha.textContent = "‚¨ÜÔ∏è";
      } else {
        cont.style.display = "none";
        flecha.textContent = "‚¨áÔ∏è";
      }
    }

    function limpiarHistorial() {
      if (confirm("¬øSeguro que deseas borrar TODO el historial?")) {
        localStorage.removeItem("historial");
        cargarVentas();
      }
    }

    function borrarVentas() {
      if (confirm("¬øSeguro que deseas borrar todas las ventas registradas?")) {
        localStorage.removeItem("ventas");
        cargarVentas();
      }
    }

    // === INICIO ===
    window.addEventListener("load", () => {
      // Restaurar usuario y fecha guardados
      if (localStorage.getItem("ultimoUsuario")) {
        usuarioInput.value = localStorage.getItem("ultimoUsuario");
      }
      if (localStorage.getItem("ultimaFecha")) {
        fechaInput.value = localStorage.getItem("ultimaFecha");
      }

      cargarPendientes();
      cargarVentas();
    });
  </script>
</body>
</html>
<script>
  const servicioSelect = document.getElementById("servicio");
  const otroDesc = document.getElementById("otroDesc");

  // Mostrar/Ocultar campo de descripci√≥n seg√∫n selecci√≥n
  servicioSelect.addEventListener("change", () => {
    if (servicioSelect.value === "Otro") {
      otroDesc.style.display = "block";
    } else {
      otroDesc.style.display = "none";
      document.getElementById("descripcion").value = ""; // limpiar cuando no sea "Otro"
    }
  });
</script>