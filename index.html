<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Registro de Ventas - SERVITEC</title>
  <style>
    :root {
      --primary: #e53935;
      --primary-dark: #c62828;
      --dark: #121212;
      --dark-light: #1e1e1e;
      --dark-lighter: #2a2a2a;
      --text: #ffffff;
      --text-secondary: #b0b0b0;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, var(--dark), var(--dark-light));
      color: var(--text);
      min-height: 100vh;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .logo {
      text-align: center;
      margin-bottom: 20px;
      animation: fadeIn 1s ease-in-out;
    }
    
    .logo img {
      max-width: 180px;
      filter: drop-shadow(0 0 10px rgba(229, 57, 53, 0.3));
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
      animation: fadeInDown 0.8s ease-in-out;
    }
    
    .header h1 {
      color: var(--primary);
      font-size: 2.2rem;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .header p {
      color: var(--text-secondary);
      font-size: 1.1rem;
    }
    
    .tabs {
      display: flex;
      background-color: var(--dark-light);
      border-radius: 10px 10px 0 0;
      overflow: hidden;
      margin-bottom: 0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .tab {
      flex: 1;
      padding: 15px 20px;
      text-align: center;
      background-color: var(--dark-light);
      color: var(--text-secondary);
      border: none;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .tab:hover {
      background-color: var(--dark-lighter);
      color: var(--text);
    }
    
    .tab.active {
      background-color: var(--dark-lighter);
      color: var(--primary);
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background-color: var(--primary);
      animation: slideIn 0.3s ease-out;
    }
    
    .tab-content {
      display: none;
      background-color: var(--dark-lighter);
      padding: 30px;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      animation: fadeIn 0.5s ease-in-out;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .card {
      background-color: var(--dark-light);
      border-radius: 10px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border-left: 4px solid var(--primary);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }
    
    .card h2 {
      color: var(--primary);
      margin-bottom: 20px;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text);
    }
    
    input, select, textarea {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #444;
      border-radius: 6px;
      background-color: var(--dark);
      color: var(--text);
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(229, 57, 53, 0.2);
    }
    
    button {
      padding: 12px 20px;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    button:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .btn-secondary {
      background-color: #444;
    }
    
    .btn-secondary:hover {
      background-color: #555;
    }
    
    .btn-danger {
      background-color: #d32f2f;
    }
    
    .btn-danger:hover {
      background-color: #b71c1c;
    }
    
    .btn-success {
      background-color: #388e3c;
    }
    
    .btn-success:hover {
      background-color: #2e7d32;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: var(--dark-light);
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    th, td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid #444;
    }
    
    th {
      background-color: var(--primary);
      color: white;
      font-weight: 600;
    }
    
    tr:last-child td {
      border-bottom: none;
    }
    
    tr {
      transition: background-color 0.2s ease;
    }
    
    tr:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }
    
    .actions {
      display: flex;
      gap: 8px;
    }
    
    .actions button {
      padding: 8px 12px;
      font-size: 0.85rem;
    }
    
    .total-ventas {
      text-align: right;
      margin-top: 20px;
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--primary);
      padding: 15px;
      background-color: var(--dark-light);
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .extra-buttons {
      display: flex;
      gap: 15px;
      margin-top: 25px;
      flex-wrap: wrap;
    }
    
    .hidden {
      display: none;
    }
    
    /* Animaciones */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes fadeInDown {
      from { 
        opacity: 0; 
        transform: translateY(-20px); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0); 
      }
    }
    
    @keyframes slideIn {
      from { transform: translateX(-100%); }
      to { transform: translateX(0); }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .tabs {
        flex-direction: column;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .extra-buttons {
        flex-direction: column;
      }
      
      table {
        display: block;
        overflow-x: auto;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">
      <img src="logo.png" alt="Logo SERVITEC">
    </div>
    
    <div class="header">
      <h1>Registro de Ventas - SERVITEC</h1>
      <p>Sistema de gesti√≥n de ventas y servicios t√©cnicos</p>
    </div>
    
    <div class="tabs">
      <button class="tab active" data-tab="ventas">üìä Ventas</button>
      <button class="tab" data-tab="pendientes">üì¶ Pendientes</button>
      <button class="tab" data-tab="historial">üìú Historial</button>
      <button class="tab" data-tab="ticket">üé´ Ticket Manual</button>
    </div>
    
    <!-- Pesta√±a de Ventas -->
    <div id="ventas" class="tab-content active">
      <div class="card">
        <h2>Registrar Nueva Venta</h2>
        <form id="ventaForm">
          <input type="hidden" id="editIndex" value="">
          
          <div class="form-grid">
            <div class="form-group">
              <label for="nombreCliente">Nombre del Cliente:</label>
              <input type="text" id="nombreCliente" required>
            </div>
            
            <div class="form-group">
              <label for="telefonoCliente">Tel√©fono del Cliente:</label>
              <input type="tel" id="telefonoCliente" required>
            </div>
            
            <div class="form-group">
              <label for="tipoTelefono">Tipo de Tel√©fono:</label>
              <input type="text" id="tipoTelefono" required>
            </div>
            
            <div class="form-group">
              <label for="usuario">Usuario (Empleado):</label>
              <input type="text" id="usuario" required>
            </div>
            
            <div class="form-group">
              <label for="servicio">Servicio:</label>
              <select id="servicio" required>
                <option value="Cambio de pantalla">Cambio de pantalla</option>
                <option value="Cambio de bater√≠a">Cambio de bater√≠a</option>
                <option value="Desbloqueo">Desbloqueo</option>
                <option value="Mantenimiento general">Mantenimiento general</option>
                <option value="Reparaci√≥n de puerto de carga">Reparaci√≥n de puerto de carga</option>
                <option value="Otro">Otro</option>
              </select>
            </div>
            
            <div class="form-group" id="otroDesc">
              <label for="descripcion">Descripci√≥n:</label>
              <textarea id="descripcion" rows="3"></textarea>
            </div>
            
            <div class="form-group">
              <label for="precio">Precio (MXN):</label>
              <input type="number" id="precio" required>
            </div>
            
            <div class="form-group">
              <label for="fecha">Fecha:</label>
              <input type="date" id="fecha" required>
            </div>
            
            <div class="form-group">
              <label for="formaPago">Forma de Pago:</label>
              <select id="formaPago" required>
                <option value="Efectivo">Efectivo</option>
                <option value="Tarjeta">Tarjeta</option>
                <option value="Transferencia">Transferencia</option>
                <option value="NO PAGADO">NO PAGADO</option>
              </select>
            </div>
          </div>
          
          <button type="submit">üíæ Guardar Venta</button>
        </form>
      </div>
      
      <div class="card">
        <h2>Ventas Registradas</h2>
        <table id="tablaVentas">
          <thead>
            <tr>
              <th>Nombre Cliente</th>
              <th>Tel√©fono</th>
              <th>Equipo</th>
              <th>Usuario</th>
              <th>Servicio</th>
              <th>Precio</th>
              <th>Fecha</th>
              <th>Forma Pago</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div id="totalVentas" class="total-ventas">Total de Ventas: $0</div>
      </div>
    </div>
    
    <!-- Pesta√±a de Pendientes -->
    <div id="pendientes" class="tab-content">
      <div class="card">
        <h2>Agregar Pendiente</h2>
        <form id="pendienteForm">
          <div class="form-grid">
            <div class="form-group">
              <label for="nombreClientePend">Nombre del Cliente:</label>
              <input type="text" id="nombreClientePend" required>
            </div>
            
            <div class="form-group">
              <label for="telefonoClientePend">Tel√©fono del Cliente:</label>
              <input type="tel" id="telefonoClientePend" required>
            </div>
            
            <div class="form-group">
              <label for="tipoTelefonoPend">Tipo de Tel√©fono:</label>
              <input type="text" id="tipoTelefonoPend" required>
            </div>
            
            <div class="form-group">
              <label for="usuarioPend">Usuario (Empleado):</label>
              <input type="text" id="usuarioPend" required>
            </div>
            
            <div class="form-group">
              <label for="servicioPend">Servicio:</label>
              <select id="servicioPend" required>
                <option value="Cambio de pantalla">Cambio de pantalla</option>
                <option value="Cambio de bater√≠a">Cambio de bater√≠a</option>
                <option value="Mantenimiento general">Mantenimiento general</option>
                <option value="Reparaci√≥n de puerto de carga">Reparaci√≥n de puerto de carga</option>
                <option value="Otro">Otro</option>
              </select>
            </div>
            
            <div class="form-group" id="otroDescPend">
              <label for="descripcionPend">Descripci√≥n:</label>
              <textarea id="descripcionPend" rows="3"></textarea>
            </div>
            
            <div class="form-group">
              <label for="precioPend">Precio (MXN):</label>
              <input type="number" id="precioPend" required>
            </div>
            
            <div class="form-group">
              <label for="fechaPend">Fecha:</label>
              <input type="date" id="fechaPend" required>
            </div>
            
            <div class="form-group">
              <label for="formaPagoPend">Forma de Pago:</label>
              <select id="formaPagoPend" required>
                <option value="Efectivo">Efectivo</option>
                <option value="Tarjeta">Tarjeta</option>
                <option value="Transferencia">Transferencia</option>
                <option value="NO PAGADO">NO PAGADO</option>
              </select>
            </div>
          </div>
          
          <button type="submit">‚ûï Agregar Pendiente</button>
        </form>
      </div>
      
      <div class="card">
        <h2>Pendientes por Entregar</h2>
        <table id="tablaPendientes">
          <thead>
            <tr>
              <th>Nombre Cliente</th>
              <th>Tel√©fono</th>
              <th>Equipo</th>
              <th>Usuario</th>
              <th>Servicio</th>
              <th>Precio</th>
              <th>Fecha</th>
              <th>Forma Pago</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    
    <!-- Pesta√±a de Historial -->
    <div id="historial" class="tab-content">
      <div class="card">
        <h2>Historial Completo</h2>
        <table id="tablaHistorial">
          <thead>
            <tr>
              <th>Nombre Cliente</th>
              <th>Tel√©fono</th>
              <th>Equipo</th>
              <th>Usuario</th>
              <th>Servicio</th>
              <th>Precio</th>
              <th>Fecha</th>
              <th>Forma Pago</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        
        <div class="extra-buttons">
          <button onclick="finalizarDia()" class="btn-success">üì§ Finalizar D√≠a</button>
          <button onclick="limpiarHistorial()" class="btn-danger">üóëÔ∏è Limpiar Historial</button>
          <button onclick="borrarVentas()" class="btn-danger">‚ùå Borrar Ventas</button>
          <button onclick="imprimirResumen()" class="btn-secondary">üñ®Ô∏è Ticket Resumen del D√≠a</button>
        </div>
      </div>
    </div>
    
    <!-- Pesta√±a de Ticket Manual -->
    <div id="ticket" class="tab-content">
      <div class="card">
        <h2>Generar Ticket Manual</h2>
        <form id="ticketManualForm">
          <div class="form-grid">
            <div class="form-group">
              <label for="nombreManual">Nombre del Cliente:</label>
              <input type="text" id="nombreManual" required>
            </div>
            
            <div class="form-group">
              <label for="telefonoManual">Tel√©fono:</label>
              <input type="tel" id="telefonoManual">
            </div>
            
            <div class="form-group">
              <label for="servicioManual">Servicio:</label>
              <input type="text" id="servicioManual" required>
            </div>
            
            <div class="form-group">
              <label for="precioManual">Precio (MXN):</label>
              <input type="number" id="precioManual" required>
            </div>
            
            <div class="form-group">
              <label for="formaPagoManual">Forma de Pago:</label>
              <select id="formaPagoManual" required>
                <option value="Efectivo">Efectivo</option>
                <option value="Tarjeta">Tarjeta</option>
                <option value="Transferencia">Transferencia</option>
                <option value="NO PAGADO">NO PAGADO</option>
              </select>
            </div>
          </div>
          
          <button type="submit">üñ®Ô∏è Generar Ticket</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Mantengo todo el JavaScript original sin cambios -->
  <script>
    // Sistema de pesta√±as
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        // Remover clase activa de todas las pesta√±as y contenidos
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        // Activar pesta√±a clickeada
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
      });
    });

    // El resto del JavaScript se mantiene igual que en el c√≥digo original
    // referencias DOM
    const usuarioInput = document.getElementById("usuario");
    const fechaInput = document.getElementById("fecha");
    const tablaBody = document.querySelector("#tablaVentas tbody");
    const historialBody = document.querySelector("#tablaHistorial tbody");
    const pendientesBody = document.querySelector("#tablaPendientes tbody");
    const totalVentasEl = document.getElementById("totalVentas");

    // === PENDIENTES ===
    function togglePendientes() {
      const cont = document.getElementById("pendientesContainer");
      const flecha = document.getElementById("flechaPend");
      if (cont.style.display === "none" || cont.style.display === "") {
        cont.style.display = "block";
        flecha.textContent = "‚¨ÜÔ∏è";
      } else {
        cont.style.display = "none";
        flecha.textContent = "‚¨áÔ∏è";
      }
    }

    document.getElementById("pendienteForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const nombreCliente = document.getElementById("nombreClientePend").value;
      const telefonoCliente = document.getElementById("telefonoClientePend").value;
      const tipoTelefono = document.getElementById("tipoTelefonoPend").value;
      const usuario = document.getElementById("usuarioPend").value;
      const servicio = document.getElementById("servicioPend").value;
      const descripcion = document.getElementById("descripcionPend").value;
      const precio = document.getElementById("precioPend").value;
      const fecha = document.getElementById("fechaPend").value;
      const formaPago = document.getElementById("formaPagoPend").value;

      let pendientes = JSON.parse(localStorage.getItem("pendientes")) || [];
      pendientes.push({ nombreCliente, telefonoCliente, tipoTelefono, usuario, servicio, descripcion, precio, fecha, formaPago });
      localStorage.setItem("pendientes", JSON.stringify(pendientes));

      e.target.reset();
      cargarPendientes();
    });

    function cargarPendientes() {
      let pendientes = JSON.parse(localStorage.getItem("pendientes")) || [];
      pendientesBody.innerHTML = "";
      pendientes.forEach((p, i) => {
        const fila = `<tr>
          <td>${p.nombreCliente}</td>
          <td>${p.telefonoCliente}</td>
          <td>${p.tipoTelefono}</td>
          <td>${p.usuario}</td>
          <td>${p.servicio}${p.descripcion ? " - " + p.descripcion : ""}</td>
          <td>$${p.precio}</td>
          <td>${p.fecha}</td>
          <td>${p.formaPago}</td>
          <td class="actions">
            <button onclick="marcarEntregado(${i})" class="btn-success">‚úÖ Entregado</button>
            <button onclick="eliminarPendiente(${i})" class="btn-danger">Eliminar</button>
          </td>
        </tr>`;
        pendientesBody.innerHTML += fila;
      });
    }

    function eliminarPendiente(i) {
      let pendientes = JSON.parse(localStorage.getItem("pendientes")) || [];
      pendientes.splice(i, 1);
      localStorage.setItem("pendientes", JSON.stringify(pendientes));
      cargarPendientes();
    }

    function marcarEntregado(i) {
      let pendientes = JSON.parse(localStorage.getItem("pendientes")) || [];
      const entregado = pendientes.splice(i, 1)[0];
      localStorage.setItem("pendientes", JSON.stringify(pendientes));

      let ventas = JSON.parse(localStorage.getItem("ventas")) || [];
      let historial = JSON.parse(localStorage.getItem("historial")) || [];

      // aseguramos estructura igual que ventas
      const nuevaVenta = {
        nombreCliente: entregado.nombreCliente || "Cliente",
        telefonoCliente: entregado.telefonoCliente || "",
        tipoTelefono: entregado.tipoTelefono || "",
        usuario: entregado.usuario || (usuarioInput.value || "Empleado"),
        servicio: entregado.servicio || "",
        descripcion: entregado.descripcion || "",
        precio: entregado.precio || 0,
        fecha: entregado.fecha || new Date().toISOString().split("T")[0],
        formaPago: entregado.formaPago || "Pendiente"
      };

      ventas.push(nuevaVenta);
      historial.push(nuevaVenta);
      localStorage.setItem("ventas", JSON.stringify(ventas));
      localStorage.setItem("historial", JSON.stringify(historial));

      cargarPendientes();
      cargarVentas();
    }

    // === VENTAS DIRECTAS ===
    document.getElementById("ventaForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const nombreCliente = document.getElementById("nombreCliente").value;
      const telefonoCliente = document.getElementById("telefonoCliente").value;
      const tipoTelefono = document.getElementById("tipoTelefono").value;
      const usuario = usuarioInput.value;
      const servicio = document.getElementById("servicio").value;
      const descripcion = document.getElementById("descripcion").value;
      const precio = document.getElementById("precio").value;
      const fecha = fechaInput.value;
      const formaPago = document.getElementById("formaPago").value;

      let ventas = JSON.parse(localStorage.getItem("ventas")) || [];
      let historial = JSON.parse(localStorage.getItem("historial")) || [];

      const nuevaVenta = { nombreCliente, telefonoCliente, tipoTelefono, usuario, servicio, descripcion, precio, fecha, formaPago };
      ventas.push(nuevaVenta);
      historial.push(nuevaVenta);

      localStorage.setItem("ultimoUsuario", usuario);
      localStorage.setItem("ultimaFecha", fecha);

      localStorage.setItem("ventas", JSON.stringify(ventas));
      localStorage.setItem("historial", JSON.stringify(historial));

      e.target.reset();

      // restaurar valores guardados
      usuarioInput.value = localStorage.getItem("ultimoUsuario") || "";
      fechaInput.value = localStorage.getItem("ultimaFecha") || "";

      cargarVentas();
    });

    // === VENTAS + HISTORIAL ===
    function cargarVentas() {
      const ventas = JSON.parse(localStorage.getItem("ventas")) || [];
      const historial = JSON.parse(localStorage.getItem("historial")) || [];
      tablaBody.innerHTML = "";
      historialBody.innerHTML = "";
      let total = 0;

      ventas.forEach((venta, index) => {
        total += parseFloat(venta.precio) || 0;
        const fila = `<tr>
          <td>${venta.nombreCliente}</td>
          <td>${venta.telefonoCliente}</td>
          <td>${venta.tipoTelefono}</td>
          <td>${venta.usuario}</td>
          <td>${venta.servicio}${venta.descripcion ? " - " + venta.descripcion : ""}</td>
          <td>$${venta.precio}</td>
          <td>${venta.fecha}</td>
          <td>${venta.formaPago}</td>
          <td class="actions">
            <button onclick="imprimirTicket(${index})" class="btn-secondary">üñ®Ô∏è Ticket</button>
            <button onclick="eliminarVenta(${index})" class="btn-danger">Eliminar</button>
          </td>
        </tr>`;
        tablaBody.innerHTML += fila;
      });

      historial.forEach((venta) => {
        const filaHist = `<tr>
          <td>${venta.nombreCliente}</td>
          <td>${venta.telefonoCliente}</td>
          <td>${venta.tipoTelefono}</td>
          <td>${venta.usuario}</td>
          <td>${venta.servicio}${venta.descripcion ? " - " + venta.descripcion : ""}</td>
          <td>$${venta.precio}</td>
          <td>${venta.fecha}</td>
          <td>${venta.formaPago}</td>
        </tr>`;
        historialBody.innerHTML += filaHist;
      });

      totalVentasEl.textContent = "Total de Ventas: $" + total.toFixed(2);
    }

    function eliminarVenta(index) {
      let ventas = JSON.parse(localStorage.getItem("ventas")) || [];
      ventas.splice(index, 1);
      localStorage.setItem("ventas", JSON.stringify(ventas));
      cargarVentas();
    }

    // === IMPRIMIR TICKET ===
    function imprimirTicket(index) {
      let ventas = JSON.parse(localStorage.getItem("ventas")) || [];
      let venta = ventas[index];
      if (!venta) return alert("Venta no encontrada.");

      // recuperar o inicializar contador de tickets
      let ticketCounter = parseInt(localStorage.getItem("ticketCounter")) || 1;
      let ticketNo = ("00000000" + ticketCounter).slice(-8); // 8 d√≠gitos

      // aumentar contador y guardar
      localStorage.setItem("ticketCounter", ticketCounter + 1);

      let ticket = window.open("", "Ticket", "width=300,height=500");
      ticket.document.write(`
        <html>
        <head>
          <title>Ticket</title>
          <style>
            body { font-family: monospace, Arial, sans-serif; font-size: 11px; text-align: center; margin: 2px; }
            .linea { border-top: 1px solid #000; margin: 2px 0; }
            .titulo { font-weight: bold; font-size: 12px; margin: 3px 0; }
            .detalle { text-align: left; margin: 2px; font-size: 11px; }
            .totales { text-align: right; font-weight: bold; margin-top: 2px; }
            .qr img { max-width: 100px; }
            .politicas { font-size: 9px; text-align: left; margin-top: 5px; }
          </style>
        </head>
        <body>
          <div><img src="logo.png" alt="Logo" style="max-width:90px;"></div>
          <!-- Eliminado SERVITEC debajo del logo -->
          <p>Calle Emilio Carranza #28 Col. Fresno del Norte</p>
          <p>Fco. I. Madero, Coah</p>
          <p>Tel: 8718968112</p>
          <div class="linea"></div>
          <div class="titulo">TICKET DE VENTA</div>
          <div class="linea"></div>
          <div class="detalle">
            <p>Fecha: ${venta.fecha} &nbsp;&nbsp; Hora: ${new Date().toLocaleTimeString()}</p>
            <p>Ticket No: ${ticketNo}</p>
            <p>Cliente: ${venta.nombreCliente}</p>
            <p>Tel√©fono: ${venta.telefonoCliente}</p>
            <p>Equipo: ${venta.tipoTelefono}</p>
            <p>Pago: ${venta.formaPago}</p>
          </div>
          <div class="linea"></div>
          <div class="detalle">
            <p>Servicios:</p>
            <p>- ${venta.servicio}${venta.descripcion ? " - " + venta.descripcion : ""}  $${venta.precio}</p>
          </div>
          <div class="linea"></div>
          <p class="totales">TOTAL: $${venta.precio}</p>
          <div class="linea"></div>
          <div class="qr">
            <img src="732a29dc-19b2-4b57-bddf-f96f73a1bb51.png" alt="QR">
          </div>
          <p>¬°Gracias por su compra!</p>
          <div class="linea"></div>
          <div class="politicas">
            <strong>POL√çTICAS DE GARANT√çA</strong><br>
            El servicio t√©cnico cuenta con 30 d√≠as de garant√≠a en refacciones.<br>
            1. Solo cubre el arreglo realizado.<br>
            2. Revisiones sin costo.<br>
            3. No aplica en equipos mojados, golpeados o con sellos rotos.<br>
            4. No aplica en software con virus o bloqueos.<br>
            5. El cliente debe revisar al recibirlo.<br>
            6. No hay reclamos despu√©s de 24 hrs.<br>
            7. No responsables por tel√©fonos olvidados que superen 30 d√≠as.<br>
          </div>
          <script>window.print();<\/script>
        </body>
        </html>
      `);
      ticket.document.close();
    }

    // === HISTORIAL ===
    function toggleHistorial() {
      const cont = document.getElementById("historialContainer");
      const flecha = document.getElementById("flecha");
      if (cont.style.display === "none" || cont.style.display === "") {
        cont.style.display = "block";
        flecha.textContent = "‚¨ÜÔ∏è";
      } else {
        cont.style.display = "none";
        flecha.textContent = "‚¨áÔ∏è";
      }
    }

    function limpiarHistorial() {
      if (confirm("¬øSeguro que deseas borrar TODO el historial?")) {
        localStorage.removeItem("historial");
        cargarVentas();
      }
    }

    function borrarVentas() {
      if (confirm("¬øSeguro que deseas borrar todas las ventas registradas?")) {
        localStorage.removeItem("ventas");
        cargarVentas();
      }
    }

    function finalizarDia() {
      let historial = JSON.parse(localStorage.getItem("historial")) || [];
      if (historial.length === 0) {
        alert("No hay historial para exportar.");
        return;
      }

      let contenido = "üìú Historial de Ventas - " + new Date().toLocaleDateString() + "\n\n";
      let total = 0;

      historial.forEach((venta, i) => {
        contenido += `${i+1}. Cliente: ${venta.nombreCliente}\n`;
        contenido += `   Tel√©fono: ${venta.telefonoCliente}\n`;
        contenido += `   Equipo: ${venta.tipoTelefono}\n`;
        contenido += `   Usuario: ${venta.usuario}\n`;
        contenido += `   Servicio: ${venta.servicio}${venta.descripcion ? " - " + venta.descripcion : ""}\n`;
        contenido += `   Precio: $${venta.precio}\n`;
        contenido += `   Forma de Pago: ${venta.formaPago}\n`;
        contenido += `   Fecha: ${venta.fecha}\n\n`;
        total += parseFloat(venta.precio) || 0;
      });

      contenido += "=========================================\n";
      contenido += `üí∞ TOTAL DEL D√çA: $${total.toFixed(2)}\n`;
      contenido += "=========================================\n";

      let blob = new Blob([contenido], { type: "text/plain" });
      let enlace = document.createElement("a");
      enlace.href = URL.createObjectURL(blob);
      enlace.download = "historial_" + new Date().toISOString().split("T")[0] + ".txt";
      enlace.click();

      localStorage.removeItem("historial");
      localStorage.removeItem("ventas");

      cargarVentas();
      alert("‚úÖ D√≠a finalizado: historial y ventas exportados y eliminados. Pendientes conservados.");
    }

    // === OTRO en SERVICIOS (Ventas y Pendientes) ===
    const servicioSelect = document.getElementById("servicio");
    const otroDesc = document.getElementById("otroDesc");
    servicioSelect.addEventListener("change", () => {
      if (servicioSelect.value === "Otro") {
        otroDesc.style.display = "block";
      } else {
        otroDesc.style.display = "none";
        document.getElementById("descripcion").value = "";
      }
    });

    const servicioPend = document.getElementById("servicioPend");
    const otroDescPend = document.getElementById("otroDescPend");
    servicioPend.addEventListener("change", () => {
      if (servicioPend.value === "Otro") {
        otroDescPend.style.display = "block";
      } else {
        otroDescPend.style.display = "none";
        document.getElementById("descripcionPend").value = "";
      }
    });

    // === INICIO ===
    window.addEventListener("load", () => {
      // restaurar usuario/fecha si existen
      if (localStorage.getItem("ultimoUsuario")) {
        usuarioInput.value = localStorage.getItem("ultimoUsuario");
      }
      if (localStorage.getItem("ultimaFecha")) {
        fechaInput.value = localStorage.getItem("ultimaFecha");
      } else {
        // default a hoy
        const hoy = new Date().toISOString().split("T")[0];
        fechaInput.value = hoy;
        document.getElementById("fechaPend").value = hoy;
      }

      cargarPendientes();
      cargarVentas();
    });
  
    // === TICKET MANUAL ===
    document.getElementById("ticketManualForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const nombre = document.getElementById("nombreManual").value;
      const telefono = document.getElementById("telefonoManual").value;
      const servicio = document.getElementById("servicioManual").value;
      const precio = document.getElementById("precioManual").value;
      const formaPago = document.getElementById("formaPagoManual").value;
      const fecha = new Date().toISOString().split("T")[0];
      const hora = new Date().toLocaleTimeString();

      let ticket = window.open("", "TicketManual", "width=300,height=650");
      ticket.document.write(`
        <html><head><title>Ticket Manual</title></head>
        <body style="font-family: monospace; font-size: 12px; text-align:center;">
          <div><img src="logo.png" style="max-width:100px;"></div>
          <p><strong>SERVITEC</strong></p>
          <p><b>Ticket Manual</b></p>
          <hr>
          <p>Fecha: ${fecha} - Hora: ${hora}</p>
          <p>Cliente: ${nombre}</p>
          <p>Tel√©fono: ${telefono}</p>
          <p>Servicio: ${servicio}</p>
          <p>Pago: ${formaPago}</p>
          <hr>
          <h3>TOTAL: $${precio}</h3>
          <hr>
          <p>¬°Gracias por su preferencia!</p>
        El servicio t√©cnico cuenta con 
        30 d√≠as de garant√≠a en refacciones.<br>
        1. Solo cubre el arreglo realizado.<br>
        2. Revisiones sin costo.<br>
        3. No aplica en equipos mojados, golpeados o con sellos rotos.<br>
        4. No aplica en software con virus o bloqueos.<br>
        5. El cliente debe revisar al recibirlo.<br>
        6. No hay reclamos despu√©s de 24 hrs.<br>
        7. no nos hacemos responsables por tel√©fonos olvidados que superen los 30 d√≠as de haber sido dejados en reparaci√≥n.<br>
        Consulte reglamento completo en el local.

          <script>window.print();<\/script>
        </body></html>
      `);
      ticket.document.close();
      e.target.reset();
    });

    // === RESUMEN DEL D√çA ===
    function imprimirResumen() {
      let historial = JSON.parse(localStorage.getItem("historial")) || [];
      if (historial.length === 0) return alert("No hay ventas en el historial.");

      let total = 0;
      let detalles = "";
      historial.forEach((venta, i) => {
        detalles += `<p>${i+1}. ${venta.nombreCliente} - ${venta.servicio}${venta.descripcion ? " - " + venta.descripcion : ""} - $${venta.precio}</p>`;
        total += parseFloat(venta.precio) || 0;
      });

      let ticket = window.open("", "ResumenDia", "width=300,height=650");
      ticket.document.write(`
        <html><head><title>Resumen del D√≠a</title></head>
        <body style="font-family: monospace; font-size: 12px; text-align:center;">
          <div><img src="logo.png" style="max-width:100px;"></div>
          <p><strong>SERVITEC</strong></p>
          <p><b>Resumen del D√≠a</b></p>
          <hr>
          ${detalles}
          <hr>
          <h3>TOTAL DEL D√çA: $${total.toFixed(2)}</h3>
          <hr>
          <p>${new Date().toLocaleDateString()} - ${new Date().toLocaleTimeString()}</p>
          <script>window.print();<\/script>
        </body></html>
      `);
      ticket.document.close();
    }
  </script>
</body>
</html>